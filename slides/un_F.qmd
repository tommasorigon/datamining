---
title: "Additive models"
subtitle: "Data Mining - CdL CLAMSES"
author: "[Tommaso Rigon]{.orange}"
institute: "_Universit√† degli Studi di Milano-Bicocca_"
execute:
  cache: false
filters: 
  - remove-pause.lua
format:
  revealjs:
    df-print: tibble
    auto-stretch: true
    center: true
    html-math-method: katex
    transition: none
    output-file: un_F_slides.html
    slide-number: true
    callout-appearance: minimal
    code-line-numbers: true
    theme: [default, ../template.css] # alternative themes (subset): default, night, dark
    embed-resources: false
    echo: false
    fig-dpi: 200
    # incremental: true  # Remove comment if you like incremental bullet points
    logo: img/logoB.png
    footer: "[Home page](https://tommasorigon.github.io/datamining)"
    highlight-style: github
  html:
    html-math-method: katex
    echo: false
    callout-appearance: minimal
    theme: [cosmo, ../template.css]
    toc: true
    toc-title: Table of contents
    embed-resources: false
    code-line-numbers: true
    smooth-scroll: true
    code-fold: false
    code-summary: "Show the code"
    fig-dpi: 200
    highlight-style: github
editor: 
  markdown: 
    wrap: 72
editor_options: 
  chunk_output_type: console
---

## [Homepage](../index.html)

```{r}
#| warning: false
#| echo: false
#| include: false
#| message: false
#| purl: false

knitr::purl("un_F.qmd", output = "../code/un_F.R")
styler:::style_file("../code/un_F.R")
```

::: columns
::: {.column width="35%"}
![](img/baseball.png){width=60% fig-align="center"} 


::: {style="font-size: 90%;"}
*"I never keep a scorecard or the batting averages. I hate statistics. What I got to know, I keep in my head."* 
:::

[Dizzy Dean]{.grey}, baseball player in the '30s and '40s.

:::

::: {.column width="65%"}

-   In this unit we will cover the following [topics]{.orange}:

    - Generalized additive models (GAMs)
    - Multivariate Adaptive Regression Splines (MARS)
    
- The running example is about baseball data... but a lot has changed since the '30s!
:::
:::

## The `Hitters` dataset

::: incremental

- We consider the `Hitters` dataset, which contains information about $n = 263$ Major League [Baseball players]{.blue} from the 1986 and 1987 seasons. 

- We want to [predict]{.blue} the [Salary]{.orange} of 1987 of each player, as a function of several covariates: 
  - number of hits/runs/walks/assists/errors in 1986 and during the whole career;
  - number of years in the major leagues;
  - The league/division of the player at the end of 1986;
  - ...and many others.
  
- We considered the logarithmic transform of the salary (`logSalary`) and the logarithmic transform of the number of years in major leagues (`logYears`).

- Including the intercept, there are in total $p = 20$ [variables]{.orange} that can be used to predict the salary of each player.

- The [original dataset](https://search.r-project.org/CRAN/refmans/ISLR/html/Hitters.html) is available in the `ISLR` R package.

:::

## A `glimpse` of the `Hitters` dataset

```{r}
#| message: false
rm(list = ls())
library(ISLR)
library(tidyverse)
data(Hitters)
Hitters <- na.omit(Hitters)
glimpse(Hitters)
```

## Preliminary operations

```{r}
# Hitters <- mutate(Hitters,
#   TotalScore = (RBI + Assists + Walks - Errors) / AtBat,
#   logAHits = log1p(CHits / Years),
#   logAAtBat = log1p(CAtBat / Years),
#   logARuns = log1p(CRuns / Years),
#   logARBI = log1p(CRBI / Years),
#   logAWalks = log1p(CWalks / Years),
#   logAHmRun = log1p(CHmRun / Years),
#   RatioHits = Hits / CHits,
#   RatioAtBat = AtBat / CAtBat,
#   RatioRuns = Runs / CRuns,
#   RatioRBI = RBI / CRBI,
#   RatioWalks = Walks / CWalks,
#   RatioHmRun = HmRun / (CHmRun + 1),
#   logYears = log(Years),
#   logSalary = log(Salary)
# ) %>% select(-c(Salary, Years))
# 
# Data splitting
set.seed(123)
id_train <- sample(1:nrow(Hitters), size = floor(0.75 * nrow(Hitters)), replace = FALSE)
id_test <- setdiff(1:nrow(Hitters), id_train)
Hitters_train <- Hitters[id_train, ]
Hitters_test <- Hitters[id_test, ]
```


<!-- ## The variable selection problem -->

<!-- ::: incremental -->

<!-- - We consider a [linear model]{.orange} in which the response variable $Y_i$ (`logSalary`) is related to the -->
<!-- covariates through the function$$ -->
<!--     \mathbb{E}(Y_i) = f(\bm{x}_i; \beta) = \beta_1 x_{i1} + \cdots + \beta_p x_{ip} =\bm{x}_i^T\beta, -->
<!--     $$  -->
<!-- using the same notation of [Unit A.1](un_A1.html). -->

<!-- - Among these $p = 26$ variables, some are likely to be [irrelevant]{.blue}, because they might be [correlated]{.orange} or even [collinear]{.orange}. -->

<!-- - As we have seen in [Unit B](un_B.html), irrelevant variables are problematic because they [increase the variance]{.orange} of the estimates without important gain in term of bias.  -->

<!-- - For the polynomial regression problem of [Unit B](un_B.html) we used [cross-validation]{.blue} and other tools to find a good [bias-variance trade-off]{.blue}. Can we use the same strategy in this example? -->

<!-- - In theory, yes... but here there are $2^{20} = 1048576$ competing models!  -->

<!-- ::: -->

<!-- ## Correlation matrix of `Hitters` -->

<!-- ```{r} -->
<!-- #| fig-width: 15 -->
<!-- #| fig-height: 7 -->
<!-- #| fig-align: center -->
<!-- library(ggcorrplot) -->
<!-- corr <- cor(subset(Hitters_train, select = -c(Salary, Division, League, NewLeague))) # Remove logSalary -->
<!-- ggcorrplot(corr, -->
<!--   hc.order = TRUE, -->
<!--   outline.col = "white", -->
<!--   ggtheme = ggplot2::theme_bw, -->
<!--   colors = c("#fc7d0b", "white", "#1170aa") -->
<!-- ) -->
<!-- ``` -->


# Generalized additive models

# MARS


## References

- 
